<div class="min-h-screen pb-20 relative overflow-hidden">
    <!-- Ambient -->
    <div class="fixed inset-0 pointer-events-none">
        <div
            class="absolute top-[-15%] right-[-10%] w-[500px] h-[500px] bg-primary/[0.05] rounded-full blur-[120px] animate-drift">
        </div>
        <div class="absolute bottom-[-10%] left-[-8%] w-[400px] h-[400px] bg-accent/[0.04] rounded-full blur-[100px] animate-drift"
            style="animation-delay:-6s"></div>
    </div>
    <div class="absolute inset-0 islamic-pattern-dense opacity-15 dark:opacity-[0.02] pointer-events-none"></div>

    <div class="relative max-w-5xl mx-auto px-6 py-10">

        <!-- Header -->
        <div class="flex flex-col sm:flex-row items-start sm:items-end justify-between gap-6 mb-10 animate-fade-down">
            <div>
                <div
                    class="inline-flex items-center gap-2 px-3 py-1 rounded-full bg-primary/[0.05] border border-primary/10 text-primary text-[10px] font-bold mb-3 uppercase tracking-wider">
                    <span class="w-1.5 h-1.5 rounded-full bg-primary animate-pulse"></span>
                    Ø§Ù„Ø®ØªÙ…Ø§Øª Ø§Ù„Ø¬Ø§Ø±ÙŠØ©
                </div>
                <h1 class="text-2xl md:text-3xl font-black text-txt">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø®ØªÙ…Ø§Øª</h1>
                <p class="text-xs text-txt-muted mt-1.5">{{khatmaService.khatmas().length}} Ø®ØªÙ…Ø© Ù…Ø³Ø¬Ù„Ø©</p>
            </div>
            <button (click)="isCreating.set(true)"
                class="group inline-flex items-center gap-2.5 px-6 py-3 bg-gradient-to-r from-primary to-secondary text-white font-bold rounded-xl text-xs shadow-lg shadow-primary/20 hover:shadow-xl hover:shadow-primary/30 hover:scale-[1.03] transition-all">
                <svg class="w-4 h-4 transition-transform group-hover:rotate-90 duration-500" fill="none"
                    viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M12 4v16m8-8H4" />
                </svg>
                Ø®ØªÙ…Ø© Ø¬Ø¯ÙŠØ¯Ø©
            </button>
        </div>

        <!-- Search -->
        <div class="relative mb-8 animate-fade-up delay-200">
            <svg class="absolute right-4 top-1/2 -translate-y-1/2 w-4 h-4 text-txt-muted" fill="none"
                viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                <circle cx="11" cy="11" r="8" />
                <path d="m21 21-4.3-4.3" />
            </svg>
            <input [(ngModel)]="searchQuery" type="text" placeholder="Ø§Ø¨Ø­Ø« Ø¨Ø§Ø³Ù… Ø§Ù„Ø®ØªÙ…Ø© Ø£Ùˆ Ø§Ù„Ù…Ù†Ø´Ø¦..."
                class="w-full md:w-96 pr-12 pl-4 py-3.5 rounded-xl border border-input-brd bg-input-bg text-txt text-sm outline-none transition-all focus:border-focus focus:shadow-[0_0_0_3px_rgba(var(--focus-rgb),0.08)]" />
        </div>

        <!-- Khatma Grid -->
        @if (filteredKhatmas().length > 0) {
        <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-5">
            @for (k of filteredKhatmas(); track k.id; let i = $index) {
            <div class="card-lift group animate-fade-up" [style.animation-delay]="(i * 60) + 'ms'">
                <div class="relative bg-surface rounded-[1.75rem] border border-brd/70 overflow-hidden h-full">
                    <div class="h-1 bg-surface-el">
                        <div class="h-full bg-gradient-to-l from-primary via-secondary to-accent transition-all duration-1000"
                            [style.width.%]="k.progress"></div>
                    </div>
                    <div class="p-5">
                        <div class="flex justify-between items-start mb-3">
                            <div class="flex-1 min-w-0">
                                @if (k.deceasedDeathDate) {
                                @let days = getDaysToAnniversary(k.deceasedDeathDate);
                                @if (days <= 30 && days>= 0) {
                                    <div
                                        class="px-2 py-0.5 rounded-md bg-accent/10 border border-accent/20 text-[9px] font-bold text-accent mb-2 w-fit animate-pulse-glow">
                                        {{days === 0 ? 'Ø§Ù„ÙŠÙˆÙ… Ø°ÙƒØ±Ù‰ Ø§Ù„ÙˆÙØ§Ø©' : 'Ø¨Ø§Ù‚ÙŠ ' + days + ' ÙŠÙˆÙ… Ø¹Ù„Ù‰ Ø§Ù„Ø°ÙƒØ±Ù‰'}}
                                    </div>
                                    }
                                    }
                                    <a [routerLink]="['/khatmat', k.id]"
                                        class="text-sm font-bold text-txt group-hover:text-primary transition-colors truncate block mb-1">{{k.title}}</a>
                                    <div class="flex flex-col gap-1">
                                        <span class="text-[10px] text-txt-muted flex items-center gap-1"><svg
                                                class="w-3 h-3" fill="none" viewBox="0 0 24 24" stroke="currentColor"
                                                stroke-width="2">
                                                <path stroke-linecap="round" stroke-linejoin="round"
                                                    d="M15.75 6a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0zM4.501 20.118a7.5 7.5 0 0114.998 0" />
                                            </svg> {{k.createdBy}}</span>
                                        @if (k.deceasedName) {
                                        <span class="text-[10px] text-accent font-medium flex items-center gap-1">ğŸ•Šï¸
                                            {{k.deceasedName}}</span>
                                        }
                                    </div>
                            </div>

                        </div>

                        <p
                            class="text-[11px] text-txt-muted line-clamp-2 mb-4 leading-relaxed bg-surface-el/50 p-2 rounded-lg border border-brd/30 italic">
                            "{{k.description}}"</p>

                        <div class="flex items-center gap-2">
                            <a [routerLink]="['/khatmat', k.id]"
                                class="flex-1 inline-flex items-center justify-center gap-1.5 px-4 py-2.5 bg-gradient-to-r from-primary to-secondary text-white font-bold rounded-lg text-[10px] hover:shadow-lg hover:shadow-primary/20 transition-all hover:scale-[1.02]">
                                <svg class="w-3 h-3" fill="none" viewBox="0 0 24 24" stroke="currentColor"
                                    stroke-width="2">
                                    <path stroke-linecap="round" stroke-linejoin="round"
                                        d="M12 6.042A8.967 8.967 0 006 3.75c-1.052 0-2.062.18-3 .512v14.25A8.987 8.987 0 016 18c2.305 0 4.408.867 6 2.292m0-14.25a8.966 8.966 0 016-2.292c1.052 0 2.062.18 3 .512v14.25A8.987 8.987 0 0018 18a8.967 8.967 0 00-6 2.292m0-14.25v14.25" />
                                </svg>
                                Ø§Ø¯Ø®Ù„ Ø§Ù„Ø®ØªÙ…Ø©
                            </a>
                            <button (click)="shareWhatsApp(k);$event.stopPropagation()"
                                class="w-9 h-9 flex items-center justify-center rounded-lg bg-[#25D366]/[0.06] text-[#25D366] hover:bg-[#25D366] hover:text-white transition-all"><svg
                                    class="w-3.5 h-3.5" fill="currentColor" viewBox="0 0 24 24">
                                    <path
                                        d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z" />
                                </svg></button>
                        </div>
                    </div>
                </div>
            </div>
            }
        </div>
        } @else {
        <div class="text-center py-20 bg-surface rounded-3xl border-2 border-dashed border-brd animate-scale-in">
            <div
                class="w-20 h-20 bg-gradient-to-br from-primary/[0.06] to-accent/[0.06] rounded-3xl flex items-center justify-center mx-auto mb-5">
                <svg class="w-8 h-8 text-primary" fill="none" viewBox="0 0 24 24" stroke="currentColor"
                    stroke-width="1.5">
                    <path stroke-linecap="round" stroke-linejoin="round"
                        d="M12 6.042A8.967 8.967 0 006 3.75c-1.052 0-2.062.18-3 .512v14.25A8.987 8.987 0 016 18c2.305 0 4.408.867 6 2.292m0-14.25a8.966 8.966 0 016-2.292c1.052 0 2.062.18 3 .512v14.25A8.987 8.987 0 0018 18a8.967 8.967 0 00-6 2.292m0-14.25v14.25" />
                </svg>
            </div>
            <h3 class="text-lg font-bold text-txt mb-2">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø®ØªÙ…Ø§Øª Ø¨Ø¹Ø¯</h3>
            <p class="text-txt-muted text-sm mb-6">Ø§Ø¨Ø¯Ø£ Ø£ÙˆÙ„ Ø®ØªÙ…Ø© ÙˆØ§ÙƒØ³Ø¨ Ø§Ù„Ø£Ø¬Ø±</p>
            <button (click)="isCreating.set(true)"
                class="px-7 py-3 bg-gradient-to-r from-primary to-secondary text-white font-bold rounded-xl text-sm hover:shadow-lg hover:shadow-primary/20 transition-all">Ø¥Ù†Ø´Ø§Ø¡
                Ø£ÙˆÙ„ Ø®ØªÙ…Ø©</button>
        </div>
        }
    </div>

    <!-- Create Modal -->
    @if (isCreating()) {
    <div class="fixed inset-0 bg-black/50 backdrop-blur-lg z-50 flex items-center justify-center p-4"
        (click)="isCreating.set(false)">
        <div class="animate-scale-in bg-surface rounded-[2rem] w-full max-w-md p-8 shadow-2xl border border-brd/70 relative overflow-hidden"
            (click)="$event.stopPropagation()">
            <div
                class="absolute -top-24 -right-24 w-48 h-48 bg-primary/[0.04] rounded-full blur-3xl pointer-events-none">
            </div>

            <div class="text-center mb-8 relative z-10">
                <div
                    class="w-16 h-16 bg-gradient-to-br from-primary to-secondary rounded-2xl flex items-center justify-center mx-auto mb-5 shadow-xl shadow-primary/20 rotate-3">
                    <svg class="w-7 h-7 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor"
                        stroke-width="1.5">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M12 4v16m8-8H4" />
                    </svg>
                </div>
                <h3 class="text-xl font-black text-txt">Ø®ØªÙ…Ø© Ø¬Ø¯ÙŠØ¯Ø©</h3>
                <p class="text-[11px] text-txt-muted mt-1.5">Ø®ØªÙ… Ø§Ù„Ù‚Ø±Ø¢Ù† Ù„Ù…Ù† ØªØ­Ø¨</p>
            </div>

            <form [formGroup]="createForm" (ngSubmit)="onSubmit()" class="space-y-4 relative z-10">
                <div><label class="block text-xs font-bold text-txt-secondary mb-1.5">Ø§Ø³Ù…Ùƒ <span
                            class="text-err">*</span></label><input formControlName="createdBy"
                        class="w-full rounded-xl border border-input-brd bg-input-bg text-txt focus:border-focus focus:ring-4 focus:ring-primary/10 p-3.5 text-sm outline-none transition-all"
                        placeholder="Ø§ÙƒØªØ¨ Ø§Ø³Ù…Ùƒ"></div>
                <div><label class="block text-xs font-bold text-txt-secondary mb-1.5">Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø®ØªÙ…Ø© <span
                            class="text-err">*</span></label><input formControlName="title"
                        class="w-full rounded-xl border border-input-brd bg-input-bg text-txt focus:border-focus focus:ring-4 focus:ring-primary/10 p-3.5 text-sm outline-none transition-all"
                        placeholder="Ù…Ø«Ø§Ù„: Ø®ØªÙ…Ø© Ø±Ù…Ø¶Ø§Ù†"></div>
                <div><label class="block text-xs font-bold text-txt-secondary mb-1.5">Ø§Ø³Ù… Ø§Ù„Ù…ØªÙˆÙÙ‰ <span
                            class="text-txt-muted font-normal">(Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</span></label><input
                        formControlName="deceasedName"
                        class="w-full rounded-xl border border-input-brd bg-input-bg text-txt focus:border-focus focus:ring-4 focus:ring-primary/10 p-3.5 text-sm outline-none transition-all"
                        placeholder="Ø±Ø­Ù…Ù‡/Ø§ Ø§Ù„Ù„Ù‡"></div>
                @if (createForm.get('deceasedName')?.value) {
                <div><label class="block text-xs font-bold text-txt-secondary mb-1.5">ØªØ§Ø±ÙŠØ® Ø§Ù„ÙˆÙØ§Ø© <span
                            class="text-txt-muted font-normal">(Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</span></label><input type="date"
                        formControlName="deceasedDeathDate"
                        class="w-full rounded-xl border border-input-brd bg-input-bg text-txt focus:border-focus focus:ring-4 focus:ring-primary/10 p-3.5 text-sm outline-none transition-all">
                </div>
                }
                <div><label class="block text-xs font-bold text-txt-secondary mb-1.5">ÙˆØµÙ <span
                            class="text-err">*</span></label><textarea formControlName="description" rows="2"
                        class="w-full rounded-xl border border-input-brd bg-input-bg text-txt focus:border-focus focus:ring-4 focus:ring-primary/10 p-3.5 text-sm outline-none transition-all resize-none"
                        placeholder="Ø®ØªÙ…Ø© Ù„Ø£Ø¬Ù„ Ø±ÙˆØ­..."></textarea></div>
                <div class="mt-8 flex gap-3">
                    <button type="button" (click)="isCreating.set(false)"
                        class="flex-1 py-3.5 text-txt-muted bg-surface-el border border-brd rounded-xl font-bold text-xs hover:bg-bg transition-colors">Ø¥Ù„ØºØ§Ø¡</button>
                    <button type="submit" [disabled]="createForm.invalid"
                        class="flex-[2] py-3.5 text-white bg-gradient-to-r from-primary to-secondary rounded-xl font-bold text-xs disabled:opacity-40 transition-all shadow-lg shadow-primary/15 hover:shadow-xl hover:shadow-primary/25 hover:scale-[1.02]">Ø¥Ù†Ø´Ø§Ø¡
                        âœ¨</button>
                </div>
            </form>
        </div>
    </div>
    }
</div>